import "../resources/filesystem/FileSystem.pkl" as FS
import "../resources/apt/Apt.pkl"
import "../resources/Resources.pkl"

url = "https://download.zerotier.com/"
codename = "bookworm"

function installed(): Listing<Resources.Resource> = new Listing {
    new FS.File {
        path = "/etc/apt/trusted.gpg.d/zerotier.com.gpg"
        content = new FS.FileContent {
            file = "modules/zerotier.com.gpg"
        }
        owner = "root"
        group = "root"
        permissions = "644"
    }

    new FS.File {
        path = "/etc/apt/sources.list.d/zerotier.list"
        owner = "root"
        group = "root"
        permissions = "644"
        content = "deb [signed-by=/etc/apt/trusted.gpg.d/zerotier.com.gpg] \(url)debian/\(codename) \(codename) main"
    }

    new Apt.Package {
        name = "zerotier-one"
        status = "installed"
        updateBeforeInstall = true
    }
}

function enabled(): Listing<Resources.Resource> = new Listing {
    ...installed()
}