import "../resources/filesystem/FileSystem.pkl"
import "../resources/apt/Apt.pkl"
import "../resources/Resources.pkl"
import "../content/Content.pkl"

url = "https://download.zerotier.com/"

function install(codename: String): Listing<Resources.Resource> = new Listing {
    new FileSystem.File {
        path = "/etc/apt/trusted.gpg.d/zerotier.com.gpg"
        state = new FileSystem.FilePresent {
            content = Content.Resource(read("zerotier.com.gpg"))
            owner = "root"
            group = "root"
            permissions = "644"
        }
    }

    new FileSystem.File {
        path = "/etc/apt/sources.list.d/zerotier.list"
        state = new FileSystem.FilePresent {
            owner = "root"
            group = "root"
            permissions = "644"
            content = "deb [signed-by=/etc/apt/trusted.gpg.d/zerotier.com.gpg] \(url)debian/\(codename) \(codename) main"
        }
    }

    new Apt.Package {
        name = "zerotier-one"
        state = "installed"
        updateBeforeInstall = true
    }
}

function remove() : Listing<Resources.Resource> = new Listing {
    new Apt.Package {
        name = "zerotier-one"
        state = "missing"
        updateBeforeInstall = true
    }
    new FileSystem.File {
        path = "/etc/apt/sources.list.d/zerotier.list"
        state = new FileSystem.Missing {}
    }
    new FileSystem.File {
        path = "/etc/apt/trusted.gpg.d/zerotier.com.gpg"
        state = new FileSystem.Missing {}
    }
}

function enable(): Listing<Resources.Resource> = new Listing {
    ...install()
    // todo
}